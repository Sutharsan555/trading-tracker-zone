<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AlphaTrack | Premium Trading Journal</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Outfit:wght@400;600;700&display=swap"
        rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-performance-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics-compat.js"></script>
    <script src="firebase-config.js"></script>

    <script>
        // Real-time Auth Persistence Check
        const checkAuth = () => {
            const isAuth = localStorage.getItem('alpha_auth') === 'true';
            const hasToken = !!localStorage.getItem('alpha_auth_token');
            if (!isAuth || !hasToken) {
                window.location.href = 'auth.html';
            }
        };

        // Firebase is initialized in firebase-config.js

        checkAuth();
    </script>
</head>

<body class="dark-theme">
    <div class="app-container">
        <aside class="sidebar">
            <div class="logo">
                <img src="logo.png" alt="Alpha Tracker Logo" class="brand-logo">
            </div>
            <nav class="nav-menu">
                <button class="nav-item active" data-tab="dashboard">
                    <i data-lucide="layout-dashboard"></i> <span>Dashboard</span>
                </button>
                <button class="nav-item" data-tab="forex">
                    <i data-lucide="coins"></i> <span>Forex Trades</span>
                </button>
                <button class="nav-item" data-tab="stocks">
                    <i data-lucide="bar-chart-2"></i> <span>Stock Trades</span>
                </button>
                <button class="nav-item" data-tab="tasks">
                    <i data-lucide="check-square"></i> <span>Daily Tasks</span>
                </button>
                <button class="nav-item" data-tab="calendar">
                    <i data-lucide="calendar"></i> <span>P/L Calendar</span>
                </button>
                <button class="nav-item" data-tab="sheets">
                    <i data-lucide="file-spreadsheet"></i> <span>Tracking Sheets</span>
                </button>
                <button class="nav-item" data-tab="journal">
                    <i data-lucide="book-open"></i> <span>Daily Journal</span>
                </button>
                <button class="nav-item" data-tab="reviews">
                    <i data-lucide="file-text"></i> <span>Reviews</span>
                </button>
                <button class="nav-item" data-tab="mobile">
                    <i data-lucide="smartphone"></i> <span>Mobile App</span>
                </button>
            </nav>
            <div class="sidebar-footer">
                <div class="user-profile">
                    <div class="user-avatar">
                        <i data-lucide="user"></i>
                    </div>
                    <div class="user-info">
                        <span id="user-email">user@alphatrack.com</span>
                        <small>Premium Plan</small>
                    </div>
                </div>
                <button class="btn-logout" id="logout-btn">
                    <i data-lucide="log-out"></i> <span>Logout</span>
                </button>
            </div>
        </aside>

        <main class="content">
            <header class="top-bar">
                <div class="header-left">
                    <button id="menu-toggle" class="btn-icon mobile-only">
                        <i data-lucide="menu"></i>
                    </button>
                    <h1 id="active-tab-title">Dashboard</h1>
                </div>
                <div class="user-info">
                    <div id="network-status" class="network-badge online">
                        <span class="pulse-dot"></span>
                        <span id="status-text">Online</span>
                    </div>
                    <span id="current-date"></span>
                    <i data-lucide="user" class="user-avatar"></i>
                </div>
            </header>

            <div class="market-ticker glass">
                <div class="ticker-wrapper" id="ticker-content">
                    <span class="ticker-item">EUR/USD: <span class="loading">...</span></span>
                    <span class="ticker-item">GBP/USD: <span class="loading">...</span></span>
                    <span class="ticker-item">USD/JPY: <span class="loading">...</span></span>
                    <span class="ticker-item">BTC/USD: <span class="loading">...</span></span>
                    <span class="ticker-item">AAPL: <span class="loading">...</span></span>
                    <span class="ticker-item">TSLA: <span class="loading">...</span></span>
                </div>
            </div>

            <section id="dashboard" class="tab-content active">
                <div class="stats-grid">
                    <div class="stat-card glass">
                        <h3>Total P/L</h3>
                        <p class="stat-value" id="total-pl">$0.00</p>
                    </div>
                    <div class="stat-card glass">
                        <h3>Win Rate</h3>
                        <p class="stat-value" id="win-rate">0%</p>
                    </div>
                    <div class="stat-card glass">
                        <h3>Total Trades</h3>
                        <p class="stat-value" id="total-trades">0</p>
                    </div>
                    <div class="stat-card glass">
                        <h3>Daily Tasks</h3>
                        <p class="stat-value" id="task-progress">0/0</p>
                    </div>
                    <div class="stat-card glass dashboard-pf-card">
                        <h3>Avg Winner</h3>
                        <p class="stat-value pl-positive" id="dash-avg-winner">$0.00</p>
                    </div>
                    <div class="stat-card glass dashboard-pf-card">
                        <h3>Avg Loser</h3>
                        <p class="stat-value pl-negative" id="dash-avg-loser">$0.00</p>
                    </div>
                    <div class="stat-card glass dashboard-pf-card">
                        <h3>Profit Factor</h3>
                        <p class="stat-value" id="dash-profit-factor">0.00</p>
                    </div>
                </div>

                <div class="chart-section glass mt-4">
                    <div class="section-header">
                        <h2>Equity Curve (Cumulative P/L)</h2>
                    </div>
                    <div class="chart-container">
                        <canvas id="equity-chart"></canvas>
                    </div>
                </div>

                <div class="recent-trades-section glass mt-4">
                    <div class="section-header">
                        <h2>Recent Trades</h2>
                        <button class="btn btn-primary" onclick="app.showAddTradeModal()">+ Add Trade</button>
                    </div>
                    <div class="table-container">
                        <table id="recent-trades-table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Asset</th>
                                    <th>Side</th>
                                    <th>Type</th>
                                    <th>Comm.</th>
                                    <th>Reason</th>
                                    <th>P/L</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Trades will be injected here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <section id="forex" class="tab-content">
                <div class="section-header">
                    <h2>Forex Trading Log</h2>
                    <button class="btn btn-primary" onclick="app.showAddTradeModal('forex')">+ Add Forex Trade</button>
                </div>
                <div class="table-container glass mt-4">
                    <table id="forex-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Pair</th>
                                <th>Side</th>
                                <th>Entry</th>
                                <th>Exit</th>
                                <th>Comm.</th>
                                <th>Reason</th>
                                <th>P/L</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </section>

            <section id="stocks" class="tab-content">
                <div class="section-header">
                    <h2>Stock Trading Log</h2>
                    <button class="btn btn-primary" onclick="app.showAddTradeModal('stocks')">+ Add Stock Trade</button>
                </div>
                <div class="table-container glass mt-4">
                    <table id="stocks-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Symbol</th>
                                <th>Side</th>
                                <th>Entry</th>
                                <th>Exit</th>
                                <th>Comm.</th>
                                <th>Reason</th>
                                <th>P/L</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </section>

            <section id="tasks" class="tab-content">
                <div class="section-header">
                    <h2>Daily Trading Tasks</h2>
                    <button class="btn btn-secondary" onclick="app.addTask()">+ New Task</button>
                </div>
                <div class="tasks-container glass mt-4" id="tasks-list">
                    <!-- Tasks will be injected here -->
                </div>
            </section>

            <section id="calendar" class="tab-content">
                <div class="section-header">
                    <h2 id="calendar-month-year">December 2025</h2>
                    <div class="calendar-controls">
                        <button class="btn-icon" onclick="app.prevMonth()"><i data-lucide="chevron-left"></i></button>
                        <button class="btn-icon" onclick="app.nextMonth()"><i data-lucide="chevron-right"></i></button>
                    </div>
                </div>
                <div class="calendar-grid glass mt-4" id="calendar-grid">
                    <!-- Calendar days will be injected here -->
                </div>
            </section>

            <section id="sheets" class="tab-content">
                <div class="section-header">
                    <h2>Tracking Sheets</h2>
                    <div class="header-actions">
                        <button class="btn btn-secondary" onclick="app.exportToCSV()">Export CSV</button>
                    </div>
                </div>
                <div class="stats-grid mt-4">
                    <div class="stat-card glass">
                        <h3>Average Winner</h3>
                        <p class="stat-value pl-positive" id="avg-winner">$0.00</p>
                    </div>
                    <div class="stat-card glass">
                        <h3>Average Loser</h3>
                        <p class="stat-value pl-negative" id="avg-loser">$0.00</p>
                    </div>
                    <div class="stat-card glass">
                        <h3>Profit Factor</h3>
                        <p class="stat-value" id="profit-factor">0.00</p>
                    </div>
                </div>
                <div class="table-container glass mt-4">
                    <table id="full-tracking-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Asset</th>
                                <th>Side</th>
                                <th>Type</th>
                                <th>Entry</th>
                                <th>Exit</th>
                                <th>Comm.</th>
                                <th>Reason</th>
                                <th>Net P/L</th>
                                <th>Efficiency</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </section>

            <section id="journal" class="tab-content">
                <div class="section-header">
                    <h2>Daily Journal</h2>
                    <button class="btn btn-primary" onclick="app.showJournalModal()">+ New Entry</button>
                </div>
                <div class="journal-feed mt-4" id="journal-list">
                    <!-- Journal entries will be injected here -->
                </div>
            </section>

            <section id="reviews" class="tab-content">
                <div class="section-header">
                    <h2>Performance Reviews</h2>
                </div>
                <div class="reviews-grid mt-4">
                    <div class="review-card glass">
                        <h3>Daily Review</h3>
                        <p>Generate a PDF summary of today's performance.</p>
                        <button class="btn btn-primary mt-4" onclick="app.exportPDF('daily')">Export Daily PDF</button>
                    </div>
                    <div class="review-card glass">
                        <h3>Weekly Review</h3>
                        <p>Summary of the current week's trades and P/L.</p>
                        <button class="btn btn-primary mt-4" onclick="app.exportPDF('weekly')">Export Weekly
                            PDF</button>
                    </div>
                    <div class="review-card glass">
                        <h3>Monthly Review</h3>
                        <p>Comprehensive monthly analysis and statistics.</p>
                        <button class="btn btn-primary mt-4" onclick="app.exportPDF('monthly')">Export Monthly
                            PDF</button>
                    </div>
                </div>
            </section>

            <section id="mobile" class="tab-content">
                <div class="section-header">
                    <h2>AlphaTrack Mobile</h2>
                </div>
                <div class="mobile-app-container glass mt-4">
                    <div class="mobile-promo">
                        <div class="promo-text">
                            <h3>Trade Anywhere, Anytime.</h3>
                            <p>Get the full AlphaTrack experience on your Android device. Track trades, log journal
                                entries, and check your P/L on the go.</p>
                            <div class="download-actions mt-4">
                                <a href="index.html" download="AlphaTrack.html" class="btn btn-primary btn-large">
                                    <i data-lucide="download"></i> Download Web-View
                                </a>
                                <p class="muted-text mt-2"><small>Version 1.0.0 | Stable Build</small></p>
                            </div>
                        </div>
                        <div class="promo-visual">
                            <div class="qr-placeholder">
                                <i data-lucide="qr-code" size="100"></i>
                                <span>Scan to Download</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            </section>
        </main>
    </div>

    <!-- Modals -->
    <div id="trade-modal" class="modal">
        <div class="modal-content glass">
            <h2>Add New Trade</h2>
            <form id="trade-form">
                <input type="hidden" id="trade-type" value="forex">
                <div class="form-group">
                    <label>Asset (Pair/Symbol)</label>
                    <input type="text" id="trade-asset" required placeholder="e.g. EUR/USD or AAPL">
                </div>
                <div class="form-group">
                    <label>Trade Side</label>
                    <select id="trade-side" class="glass-input" required>
                        <option value="Long">Long / Buy</option>
                        <option value="Short">Short / Sell</option>
                    </select>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Entry Price</label>
                        <input type="number" id="trade-entry" step="0.00001" required>
                    </div>
                    <div class="form-group">
                        <label>Exit Price</label>
                        <input type="number" id="trade-exit" step="0.00001" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Profit / Loss ($)</label>
                        <input type="number" id="trade-pl" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label>Commission ($)</label>
                        <input type="number" id="trade-commission" step="0.01" value="0.00" required>
                    </div>
                </div>
                <div class="form-group">
                    <label>Date</label>
                    <input type="date" id="trade-date" required>
                </div>
                <div class="form-group">
                    <label>Trade Reason / Setup</label>
                    <textarea id="trade-reason" placeholder="e.g. Trendline breakout, RSI divergence..."
                        class="glass-input" rows="3"></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="app.closeModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Trade</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Journal Modal -->
    <div id="journal-modal" class="modal">
        <div class="modal-content glass">
            <h2 id="journal-modal-title">New Journal Entry</h2>
            <form id="journal-form">
                <input type="hidden" id="journal-id">
                <div class="form-group">
                    <label>Title</label>
                    <input type="text" id="journal-title" required placeholder="e.g. FOMC Meeting Reflection">
                </div>
                <div class="form-group">
                    <label>Date</label>
                    <input type="date" id="journal-date" required>
                </div>
                <div class="form-group">
                    <label>Entry Content</label>
                    <textarea id="journal-content" placeholder="How was the market today? What did you learn?"
                        class="glass-input" rows="8" required></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="app.closeJournalModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Entry</button>
                </div>
            </form>
        </div>
    </div>

    <script src="app.js"></script>
</body>

</html>